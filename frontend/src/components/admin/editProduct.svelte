<script lang="ts">
	
    import { Form, FormGroup, Input, Label } from 'sveltestrap';
    import {  Button } from 'sveltestrap';
    import { onMount } from 'svelte';
    import { navigate } from "svelte-navigator";

	  let selected1;
    let product_name;
    let description_product;
    let price_product;
    let stock_product;
    let names =[];
    let products = []; 

      onMount(async () => {
        const res = await fetch("http://127.0.0.1:8000/products/");
        products = await res.json();
          for (let proObj of products) {
              if (!names.includes(proObj.product_name)) {
                names = [...names, proObj.product_name]
              }
          }
          names = names.sort();
          console.log(names);
      })

    function viewProducts(){
      navigate("/ListProduct")
    }
  
    function formHandler(event) {
      event.preventDefault()
      let i=selected1;
        
      fetch('http://localhost:8000/products/?id='+i,{
        method:  'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          product_name:product_name,
          price:price_product,
          stock:stock_product,
          description:description_product		
        })
      })
        .then(response => response.json())
        .then(result => console.log(result))
        .then(viewProducts)
    }
  </script>
  <Form >
    <h1 class="text-center text-product">Edit Product</h1>
    <FormGroup>
        <Label for="exampleSelect">Product Name</Label>
        <Input type="select" name="select1" id="product_name" bind:value={selected1}>
          {#each products as product}
                  <option value={product.id}>{product.product_name}</option>
          {/each}
        </Input>
    </FormGroup>
		 <FormGroup>
        <Label for="examplePassword">New Name Product</Label>
        <Input
          type="text"
          name="name"
          id="name"
          placeholder="Example: 1000"
          bind:value={product_name}
        />
    </FormGroup>
    <FormGroup>
        <Label for="examplePassword">Price</Label>
        <Input
          type="text"
          name="price"
          id="price"
          placeholder="Example: 1000"
          bind:value={price_product}
        />
    </FormGroup>
    <FormGroup>
      <Label for="examplePassword">Stock</Label>
      <Input
        type="text"
        name="stock"
        id="stock"
        placeholder="Example: 1000"
        bind:value={stock_product}
      />
    </FormGroup>
    <FormGroup>
      <Label for="exampleText">Description</Label>
      <Input type="text" name="text" id="description" bind:value={description_product}/>
    </FormGroup>
    <FormGroup>
    <Button on:click={formHandler} color="primary"> Apply changes</Button>
    </FormGroup>
  </Form>